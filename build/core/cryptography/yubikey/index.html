<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-build/core/cryptography/yubikey">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Yubikey implementation | Archethic</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://wiki.archethic.net/build/core/cryptography/yubikey"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Yubikey implementation | Archethic"><meta data-rh="true" name="description" content="This section explains the HRT Yubikey Library implementation."><meta data-rh="true" property="og:description" content="This section explains the HRT Yubikey Library implementation."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://wiki.archethic.net/build/core/cryptography/yubikey"><link data-rh="true" rel="alternate" href="https://wiki.archethic.net/build/core/cryptography/yubikey" hreflang="en"><link data-rh="true" rel="alternate" href="https://wiki.archethic.net/build/core/cryptography/yubikey" hreflang="x-default"><script src="https://plausible.io/js/script.js" defer="defer" data-domain="wiki.archethic.net"></script><link rel="stylesheet" href="/assets/css/styles.e924534f.css">
<link rel="preload" href="/assets/js/runtime~main.c854ac63.js" as="script">
<link rel="preload" href="/assets/js/main.02f0e146.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/archethic-white.png" alt="Archethic Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/archethic-black.png" alt="Archethic Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Archethic</b></a><a class="navbar__item navbar__link" href="/learn">Learn</a><a class="navbar__item navbar__link" href="/category/participate">Participate</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/category/build">Build</a><a class="navbar__item navbar__link" href="/category/FAQ">FAQ</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/archethic-foundation/archethic-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/learn/">Learn</a><button aria-label="Toggle the collapsible sidebar category &#x27;Learn&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/participate">Participate</a><button aria-label="Toggle the collapsible sidebar category &#x27;Participate&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/category/build">Build</a><button aria-label="Toggle the collapsible sidebar category &#x27;Build&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/category/clients">Clients</a><button aria-label="Toggle the collapsible sidebar category &#x27;Clients&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/category/api">API</a><button aria-label="Toggle the collapsible sidebar category &#x27;API&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/build/core/">Core development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Core development&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/build/core/account">Account</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/build/core/beacon-chain/">BeaconChain</a><button aria-label="Toggle the collapsible sidebar category &#x27;BeaconChain&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/build/core/bootstrap">Bootstrap</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/build/core/cryptography/">Cryptography</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cryptography&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/build/core/cryptography/tpm">TPM Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/build/core/cryptography/yubikey">Yubikey implementation</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/build/core/database">Archethic&#x27;s database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/build/core/election">Election</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/build/core/governance/code-proposals-cd">governance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/build/core/mining/">Mining</a><button aria-label="Toggle the collapsible sidebar category &#x27;Mining&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/build/core/oracle-chain/">OracleChain</a><button aria-label="Toggle the collapsible sidebar category &#x27;OracleChain&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/build/core/p2p/">P2P</a><button aria-label="Toggle the collapsible sidebar category &#x27;P2P&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/category/dapp-development">DApp development</a><button aria-label="Toggle the collapsible sidebar category &#x27;DApp development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/build/sdk/">SDK</a><button aria-label="Toggle the collapsible sidebar category &#x27;SDK&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/build/smart-contracts/">Smart Contracts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Smart Contracts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/build/testnet">Testnet</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/category/faq">FAQ</a><button aria-label="Toggle the collapsible sidebar category &#x27;FAQ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contributing">Contributing</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/category/build"><span itemprop="name">Build</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/build/core/"><span itemprop="name">Core development</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/build/core/cryptography/"><span itemprop="name">Cryptography</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Yubikey implementation</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Yubikey implementation</h1></header><p>This section explains the HRT Yubikey Library implementation.</p><div class="theme-admonition theme-admonition-success alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Reference Files:
<a href="https://github.com/UNIRIS/yubikey-core/blob/main/uniris-yubikey.c" target="_blank" rel="noopener noreferrer">uniris-yubikey.c</a>
<a href="https://github.com/UNIRIS/yubikey-core/blob/main/uniris-yubikey.h" target="_blank" rel="noopener noreferrer">uniris-yubikey.h</a></p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="initializeyk-">initializeYK() :<a href="#initializeyk-" class="hash-link" aria-label="Direct link to initializeYK() :" title="Direct link to initializeYK() :">​</a></h2><p>Initializes the context of the yubikey application in the variable g_state and connects to the hardware device. If successful, then gets the key index of Archethic as well as key index of the yubikey device.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="bool-checkyk">bool checkYK():<a href="#bool-checkyk" class="hash-link" aria-label="Direct link to bool checkYK():" title="Direct link to bool checkYK():">​</a></h2><p>displays the model of yubikey device used returns true if the device list contains &quot;Yubico Yubikey&quot;.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="verifypinyk">verifyPinYK():<a href="#verifypinyk" class="hash-link" aria-label="Direct link to verifyPinYK():" title="Direct link to verifyPinYK():">​</a></h2><p>verifies the pin code using ykpiv_verify() required to access PIV interface.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="authenticateyk">authenticateYK():<a href="#authenticateyk" class="hash-link" aria-label="Direct link to authenticateYK():" title="Direct link to authenticateYK():">​</a></h2><p>Management key is required to do administrative actions. First it does hex decoding of the management key and authenticates if ykpiv_authenticate() returns 0.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="fetchkeykeyindex">fetchKey(keyIndex):<a href="#fetchkeykeyindex" class="hash-link" aria-label="Direct link to fetchKey(keyIndex):" title="Direct link to fetchKey(keyIndex):">​</a></h2><p>A PIV card contains some interoperable seven mandatory and  twenty optional data objects. These objects are identified with their respective ids. We use these twenty optional data objects to store the  key certificates. fetchKey index takes the yubikey key index ykindex as input and fetches the certificate at the key_certificates<!-- -->[ykindex]<!-- -->. This X509 certificate is decoded and public key is extracted from it using X509_get0_pubkey_bitstr and copied to ecc_public_key.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generatekeyykindex">generateKey(ykIndex):<a href="#generatekeyykindex" class="hash-link" aria-label="Direct link to generateKey(ykIndex):" title="Direct link to generateKey(ykIndex):">​</a></h2><p>It takes the ykIndex and generates an ECC key using ykpiv_util_generate_key(). It generates key at one of the slots {0x82.. 0x95}  pointed by ykindex - key_slots<!-- -->[ykIndex]</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generatecertificateykindex">generateCertificate(ykIndex):<a href="#generatecertificateykindex" class="hash-link" aria-label="Direct link to generateCertificate(ykIndex):" title="Direct link to generateCertificate(ykIndex):">​</a></h2><p>The keys in the slot are attested through  ykpiv_attest() by taking the slot on the index as input. It returns attested key and its length which is then saved into an object pointed by ykIndex using ykpiv_save_object().</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getykindex">getYKIndex():<a href="#getykindex" class="hash-link" aria-label="Direct link to getYKIndex():" title="Direct link to getYKIndex():">​</a></h2><p>The YKPIV_OBJ_KEY_HISTORY keeps the count of the keys generated in the yubikey. This fucntion fetches the YKPIV_OBJ_KEY_HISTORY using ykpiv_fetch_object() to get the index_yk and returns it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="saveindexykindex-archethicindex">saveIndex(ykIndex, archethicIndex):<a href="#saveindexykindex-archethicindex" class="hash-link" aria-label="Direct link to saveIndex(ykIndex, archethicIndex):" title="Direct link to saveIndex(ykIndex, archethicIndex):">​</a></h2><p>It takes  ykindex and archethicIndex as input and generates index by combining ykindex and archethic index and keeps it in YKPIV_OBJ_HISTORY.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="signecdsahashtosign-ykindex">signECDSA(hashtoSign, ykIndex):<a href="#signecdsahashtosign-ykindex" class="hash-link" aria-label="Direct link to signECDSA(hashtoSign, ykIndex):" title="Direct link to signECDSA(hashtoSign, ykIndex):">​</a></h2><p>It uses ykpiv_sign_data() to sign hashToSign using YKPIV_ALGO_ECCP256 through the key pointed by ykindex - key_slots<!-- -->[ykindex]<!-- -->.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getecdhpointykindex-euphermerakley-">getECDHPoint(ykIndex, euphermerakley) :<a href="#getecdhpointykindex-euphermerakley-" class="hash-link" aria-label="Direct link to getECDHPoint(ykIndex, euphermerakley) :" title="Direct link to getECDHPoint(ykIndex, euphermerakley) :">​</a></h2><p>It generated an ecdh point using ykpiv_decipher_data() for the slot pointed by ykindex key_slots<!-- -->[ykIndex]<!-- -->.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getarchethicindex">getArchEthicIndex():<a href="#getarchethicindex" class="hash-link" aria-label="Direct link to getArchEthicIndex():" title="Direct link to getArchEthicIndex():">​</a></h2><p>Fetches the YKPIV_OBJ_KEY_HISTORY and derives the archethicindex from index_yk saved in key history object.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="incrementindex">incrementIndex():<a href="#incrementindex" class="hash-link" aria-label="Direct link to incrementIndex():" title="Direct link to incrementIndex():">​</a></h2><p>We use the 20 data objects to store 20 keys certificates at once. The 21st key generated on the yubikey is stored in newYKIndex = ykindex % 20. The archethic index is incremented and a new key is generated using newYKindex .A certificate is generated and saved in the slot pointed by newYKindex. Finally it returns true if the current YK index is equal to newYKindex and current archethicindex is equal to newarchethic index .</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getrootkey">getRootKey():<a href="#getrootkey" class="hash-link" aria-label="Direct link to getRootKey():" title="Direct link to getRootKey():">​</a></h2><p>Reads the root key certificate from f9 slot and fetches public key from the certificate. Finally it copies the key into rsa_root_key and returns it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getcurrentkeypublickeysize">getCurrentKey(publicKeySize):<a href="#getcurrentkeypublickeysize" class="hash-link" aria-label="Direct link to getCurrentKey(publicKeySize):" title="Direct link to getCurrentKey(publicKeySize):">​</a></h2><p>Generates the previous key index by and fetches the key behind previous key index and returns the ecc key.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getnextkey-publickeysize">getNextKey( publicKeySize):<a href="#getnextkey-publickeysize" class="hash-link" aria-label="Direct link to getNextKey( publicKeySize):" title="Direct link to getNextKey( publicKeySize):">​</a></h2><p>It fetches the key from the ykIndex and returns the ecc_public_key behind the index.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getpastkeyarchethicindex-publickeysize">getPastKey(archEthicIndex, publicKeySize):<a href="#getpastkeyarchethicindex-publickeysize" class="hash-link" aria-label="Direct link to getPastKey(archEthicIndex, publicKeySize):" title="Direct link to getPastKey(archEthicIndex, publicKeySize):">​</a></h2><p>It fetches the keys stored previously in the slot. It first calculates the slot position and then fetches the key at the slot position and return it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getrootcertificate-certificatesize">getRootCertificate( certificateSize):<a href="#getrootcertificate-certificatesize" class="hash-link" aria-label="Direct link to getRootCertificate( certificateSize):" title="Direct link to getRootCertificate( certificateSize):">​</a></h2><p>Reads the certificate of the rootkey from 0xf9 slot, copies it ykcertificate and returns it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getcurrentcertificatecertificatesize">getCurrentCertificate(certificateSize):<a href="#getcurrentcertificatecertificatesize" class="hash-link" aria-label="Direct link to getCurrentCertificate(certificateSize):" title="Direct link to getCurrentCertificate(certificateSize):">​</a></h2><p>Calculates the curent key index and fetches the certificate from the object pointed by the current key index.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getnextcertificatecertificatesize">getNextCertificate(certificateSize):<a href="#getnextcertificatecertificatesize" class="hash-link" aria-label="Direct link to getNextCertificate(certificateSize):" title="Direct link to getNextCertificate(certificateSize):">​</a></h2><p>fetches the certificate of the  key pointed by ykindex and returns it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getpastcertificatearchethicindex-certificatesize">getPastCertificate(archEthicIndex, certificateSize):<a href="#getpastcertificatearchethicindex-certificatesize" class="hash-link" aria-label="Direct link to getPastCertificate(archEthicIndex, certificateSize):" title="Direct link to getPastCertificate(archEthicIndex, certificateSize):">​</a></h2><p>calculates the slot posistion according to the offset using archethicindex then fetches the object at the slot position which is a certificate amd returns it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="signcurrentkeyhashtosign-eccsignsize">signCurrentKey(hashToSign, eccSignSize):<a href="#signcurrentkeyhashtosign-eccsignsize" class="hash-link" aria-label="Direct link to signCurrentKey(hashToSign, eccSignSize):" title="Direct link to signCurrentKey(hashToSign, eccSignSize):">​</a></h2><p>Calculates the current key index then verifies the Yubikey pin using verifyPinYK() and then signs hashToSign using signECDSA(). The signECDSA() signs the key at the currentkeyindex.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="signpastkeyarchethicindex-hashtosign-eccsignsize">signPastKey(archEthicIndex, hashToSign, eccSignSize):<a href="#signpastkeyarchethicindex-hashtosign-eccsignsize" class="hash-link" aria-label="Direct link to signPastKey(archEthicIndex, hashToSign, eccSignSize):" title="Direct link to signPastKey(archEthicIndex, hashToSign, eccSignSize):">​</a></h2><p>Calculates the slot position by first calculating the offset by using archethicindex. Then it verifies the yubikey pin and signs the key pointed at the slotPosition.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ecdhcurrentkeyeuphemeralkey-eccpointsize">ecdhCurrentKey(euphemeralKey, eccPointSize):<a href="#ecdhcurrentkeyeuphemeralkey-eccpointsize" class="hash-link" aria-label="Direct link to ecdhCurrentKey(euphemeralKey, eccPointSize):" title="Direct link to ecdhCurrentKey(euphemeralKey, eccPointSize):">​</a></h2><p>Calculates the current key index, verifies the yubikey pin to get the ECDH point through getECDHPoint() fucntion and finally returns it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ecdhpastkey-archethicindex-euphemeralkey-eccpointsize">ecdhPastKey( archEthicIndex, euphemeralKey, eccPointSize):<a href="#ecdhpastkey-archethicindex-euphemeralkey-eccpointsize" class="hash-link" aria-label="Direct link to ecdhPastKey( archEthicIndex, euphemeralKey, eccPointSize):" title="Direct link to ecdhPastKey( archEthicIndex, euphemeralKey, eccPointSize):">​</a></h2><p>Calculates the offset and slotPosition using archEthicIndex., verifies Yubikey PIN and gets the ECDH point for the key pointed by slotPosiotion and returns it.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-12-26T17:03:04.000Z">Dec 26, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/build/core/cryptography/tpm"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">TPM Implementation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/build/core/database"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Archethic&#x27;s database</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#initializeyk-" class="table-of-contents__link toc-highlight">initializeYK() :</a></li><li><a href="#bool-checkyk" class="table-of-contents__link toc-highlight">bool checkYK():</a></li><li><a href="#verifypinyk" class="table-of-contents__link toc-highlight">verifyPinYK():</a></li><li><a href="#authenticateyk" class="table-of-contents__link toc-highlight">authenticateYK():</a></li><li><a href="#fetchkeykeyindex" class="table-of-contents__link toc-highlight">fetchKey(keyIndex):</a></li><li><a href="#generatekeyykindex" class="table-of-contents__link toc-highlight">generateKey(ykIndex):</a></li><li><a href="#generatecertificateykindex" class="table-of-contents__link toc-highlight">generateCertificate(ykIndex):</a></li><li><a href="#getykindex" class="table-of-contents__link toc-highlight">getYKIndex():</a></li><li><a href="#saveindexykindex-archethicindex" class="table-of-contents__link toc-highlight">saveIndex(ykIndex, archethicIndex):</a></li><li><a href="#signecdsahashtosign-ykindex" class="table-of-contents__link toc-highlight">signECDSA(hashtoSign, ykIndex):</a></li><li><a href="#getecdhpointykindex-euphermerakley-" class="table-of-contents__link toc-highlight">getECDHPoint(ykIndex, euphermerakley) :</a></li><li><a href="#getarchethicindex" class="table-of-contents__link toc-highlight">getArchEthicIndex():</a></li><li><a href="#incrementindex" class="table-of-contents__link toc-highlight">incrementIndex():</a></li><li><a href="#getrootkey" class="table-of-contents__link toc-highlight">getRootKey():</a></li><li><a href="#getcurrentkeypublickeysize" class="table-of-contents__link toc-highlight">getCurrentKey(publicKeySize):</a></li><li><a href="#getnextkey-publickeysize" class="table-of-contents__link toc-highlight">getNextKey( publicKeySize):</a></li><li><a href="#getpastkeyarchethicindex-publickeysize" class="table-of-contents__link toc-highlight">getPastKey(archEthicIndex, publicKeySize):</a></li><li><a href="#getrootcertificate-certificatesize" class="table-of-contents__link toc-highlight">getRootCertificate( certificateSize):</a></li><li><a href="#getcurrentcertificatecertificatesize" class="table-of-contents__link toc-highlight">getCurrentCertificate(certificateSize):</a></li><li><a href="#getnextcertificatecertificatesize" class="table-of-contents__link toc-highlight">getNextCertificate(certificateSize):</a></li><li><a href="#getpastcertificatearchethicindex-certificatesize" class="table-of-contents__link toc-highlight">getPastCertificate(archEthicIndex, certificateSize):</a></li><li><a href="#signcurrentkeyhashtosign-eccsignsize" class="table-of-contents__link toc-highlight">signCurrentKey(hashToSign, eccSignSize):</a></li><li><a href="#signpastkeyarchethicindex-hashtosign-eccsignsize" class="table-of-contents__link toc-highlight">signPastKey(archEthicIndex, hashToSign, eccSignSize):</a></li><li><a href="#ecdhcurrentkeyeuphemeralkey-eccpointsize" class="table-of-contents__link toc-highlight">ecdhCurrentKey(euphemeralKey, eccPointSize):</a></li><li><a href="#ecdhpastkey-archethicindex-euphemeralkey-eccpointsize" class="table-of-contents__link toc-highlight">ecdhPastKey( archEthicIndex, euphemeralKey, eccPointSize):</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/archethic-foundation/archethic-node" target="_blank" rel="noopener noreferrer" class="footer__link-item">Archethic Node<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/archethic-foundation/libjs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Archethic Javascript SDK<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/archethic-foundation/libdart" target="_blank" rel="noopener noreferrer" class="footer__link-item">Archethic Dart SDK<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/archethic-foundation/archethic-wallet" target="_blank" rel="noopener noreferrer" class="footer__link-item">Archethic Wallet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Archethic Foundation. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c854ac63.js"></script>
<script src="/assets/js/main.02f0e146.js"></script>
</body>
</html>